(function(e){function r(e,t){if(e instanceof r)return e;if(arguments.length==0){if(this instanceof r)return;return new r}if(!(this instanceof r))return new r(e,t);this.length=0,this._tq_selector=e,this._tq_context=t||this._tqGetDefaultContext(),this._tq_strategy=this._tqGetStrategy();if(Array.isArray(e)){for(var n in e)this.indexOf(e[n])==-1&&this.push(e[n]);return this}if(this._tq_strategy._tq_accepts(this._tq_selector))return this.push(this._tq_selector),console.assert(this.length==1,this),this;if(typeof e=="string"){var i=this._tq_strategy._tq_parse(e);return i instanceof r?i:$(this._tq_context,this._tq_context).find(e)}}function s(e,t){}var t="0.1.0",n=[];r.prototype=n,n.constructor=r,n._tqGetStrategy=function(){return r.Factory.getStrategy(this._tq_selector,this._tq_context)},n.valueOf=function(){return this.map(function(e){return e})},n._tqGetDefaultContext=function(){return document.body},n.find=function(e){return this._tq_selector=e,r.Engine.resolve(this)},n.children=function(){return r.Engine.children(this)},n.filter=function(e){return this._tq_selector=e,r.Engine.filter(this,e)},r._tq_version=t,r._tq=n,r._tq_types={},r.register=function(e,t){console.log("TreeQuery.register",e,t);var i=new s;for(var o in i)typeof i[o]=="function"&&!t[o]&&(t[o]=i[o]);r._tq_types[e]=t;for(var e in t)typeof t[e]=="function"&&!n[e]&&function(e){n[e]=function(){var n=[null];for(var r=0;r<arguments.length;r++)n.push(arguments[r]);n.push(0),n.push(this.length);for(var r=0;r<this.length;r++){n[0]=this[r],n[n.length-2]=r;var i=this._tq_strategy[e].apply(t,n);if(i!=this._tq_strategy)return i}return this}}(e)},r.Filters=function(e){this._filters=[],this._strategy=e},r.Filters.prototype={},r.Filters.prototype.constructor=r.Filters,r.Filters.prototype.append=function(e){this._filters.push(e)},r.Filters.prototype.check=function(e,t){var n=t||this._strategy;this._filters||console.warn("WARNING: check function not overwritten for this class: ",this);for(var r in this._filters){console.assert(typeof this._filters[r].check=="function",this._filters[r]);if(!this._filters[r].check(e,n))return!1}return this._filters.length>0},r.Filters.TageNameFilter=function(e){this._tagname=e.toLowerCase()},r.Filters.TageNameFilter.prototype=new r.Filters,r.Filters.TageNameFilter.prototype.constructor=r.Filters.TageNameFilter,r.Filters.TageNameFilter.prototype.check=function(e,t){return t.tagName(e).toLowerCase()==this._tagname},r.Filters.IdFilter=function(e){this._id=e.toLowerCase()},r.Filters.IdFilter.prototype=new r.Filters,r.Filters.IdFilter.prototype.constructor=r.Filters.IdFilter,r.Filters.IdFilter.prototype.check=function(e,t){var n=t.id(e);return typeof n=="string"?n.toLowerCase()==this._id:!1},r.Filters.ClassFilter=function(e){this._classname=e.toLowerCase()},r.Filters.ClassFilter.prototype=new r.Filters,r.Filters.ClassFilter.prototype.constructor=r.Filters.ClassFilter,r.Filters.ClassFilter.prototype.check=function(e,t){var n=t.class(e);for(var r in n)if(n[r].toLowerCase()==this._classname)return!0;return!1},r.Filters.AsterFilter=function(){},r.Filters.AsterFilter.prototype=new r.Filters,r.Filters.AsterFilter.prototype.constructor=r.Filters.AsterFilter,r.Filters.AsterFilter.prototype.check=function(){return!0},r.Engine={parseSelector:function(e){return[]},filter:function(e){var t=[],n=r.Factory.getFilter(e._tq_selector,e._tq_strategy),i=e.map(function(e){return e});while(i.length>0){var s=i.splice(0,1)[0];n.check(s)&&t.push(s)}return $(t,e._tq_context)},find:function(e){var t=[],n=r.Factory.getFilter(e._tq_selector,e._tq_strategy),i=e.map(function(e){return e});while(i.length>0){var s=i.splice(0,1)[0],o=e._tq_strategy.children(s);for(var u in o)i.push(o[u]),n.check(o[u])&&t.push(o[u])}return $(t,e._tq_context)},apply:function(e,t,n,r){},resolve:function(e){var t=r;console.assert(typeof e._tq_selector=="string",e._tq_selector);var n,i=[],s=e._tq_selector.split(","),o=e._tq_selector.split(" "),u=s.length>1,a=o.length>1;if(u){n=s;for(var f in n)var l=i=i.concat(e.find(n[f]).valueOf());return t(i,e._tq_context)}if(a){n=o;function c(e,t){return e.find(t)}function h(e,t){return e.children().filter(t)}var p=c;$current=e;for(var f in n){if(n[f]=="")continue;if(n[f]==">"){p=h;continue}$current=p($current,n[f]),p=c}return $current}return r.Engine.find(e)},children:function(e){var t=[],n=e.map(function(e){return e});while(n.length>0){var r=n.splice(0,1)[0],i=e._tq_strategy.children(r);t=t.concat(i)}return $(t,e._tq_context)},cache:{}},r.Factory={getStrategy:function(e,t){if(typeof r.Factory.cache[t]!="undefined")return r.Factory.cache[t];for(var n in r._tq_types){var i=r._tq_types[n];if(i._tq_accepts(t,e))return r.Factory.cache[t]=i,i}return null},getFilter:function(e,t){console.assert(typeof e=="string",e),console.assert(e.split(" ").length==1,e);var n=/:(\w+)\(/,i=/:(\w+)/,s,o,u,a,f,l,c;o=e;if(e.indexOf(".")!=-1){var s=e.split(".");o=s.splice(0,1)[0],a=s.map(function(e){return e.split("[")[0].split(":")[0]})}e=="*"&&(o="",c=!0);if(e.indexOf("#")!=-1){var s=e.split("#");o=s[0],u=s[1].split("[")[0].split(":")[0]}if(e.indexOf(":")!=-1){var s=e.split(":");f=s[1],u=s[1].split("[")[0].split(":")[0]}if(n.test(e)){var s=text.match(n);l=s[1]}else if(i.test(e)){var s=text.match(i);f=s[1]}var h=new r.Filters(t);c&&h.append(new r.Filters.AsterFilter),o&&h.append(new r.Filters.TageNameFilter(o)),u&&h.append(new r.Filters.IdFilter(u));for(var p in a)h.append(new r.Filters.ClassFilter(a[p]));return h},cache:{}};var i="ERROR: 'XXX' function must be overwritten";s.prototype={},s.prototype.constructor=s,s.prototype._tq_accepts=function(e){return console.error(i.replace("XXX","check")),!1},s.prototype.class=function(e,t){console.error(i.replace("XXX","class"))},s.prototype.addClass=function(e){console.error(i.replace("XXX","addClass"))},s.prototype.removeClass=function(e){console.error(i.replace("XXX","removeClass"))},s.prototype.hasClass=function(e){console.error(i.replace("XXX","hasClass"))},s.prototype.attributes=function(e,t){console.error(i.replace("XXX","atributtes"))},s.prototype.attr=function(e,t,n){console.error(i.replace("XXX","atributtes"))},s.prototype.removeAttr=function(e,t){console.error(i.replace("XXX","removeAttr"))},s.prototype.children=function(e,t){console.error(i.replace("XXX","children"))},s.prototype.addChild=function(e){console.error(i.replace("XXX","addChild"))},s.prototype.removeChild=function(e){console.error(i.replace("XXX","removeChild"))},s.prototype.parent=function(e,t){console.error(i.replace("XXX","parent"))},s.prototype.tagName=function(e){console.error(i.replace("XXX","tagName"))},s.prototype.id=function(e,t){console.error(i.replace("XXX","id"))},function(e){typeof define=="function"&&define.amd?define(["treequery"],e):typeof r!="undefined"?e(r):console.error("ERROR: can't register type. Enable to locate TreeQuery instance")}(function(e){e.register("html-element",{_tq_accepts:function(e){return e instanceof HTMLElement},_tq_parse:function(t){try{var n=document.createElement("div");n.innerHTML=t;var r=Array.prototype.map.call(n.childNodes,function(e){return e});return r.length==1&&r[0]instanceof Text?null:e(r)}catch(i){return null}},"class":function(e,t){return console.assert(this._tq_accepts(e),e),t?(e.className=t,this):e.className.split(" ")},addClass:function(e,t){return console.assert(this._tq_accepts(e),e),e.className+=" "+t,this},removeClass:function(e,t){return console.assert(this._tq_accepts(e),e),e.className=e.className.replace(new RegExp("(?:^|\\s)"+t+"(?!\\S)","g"),""),this},hasClass:function(e,t){console.assert(this._tq_accepts(e),e);var n=new RegExp("(?:^|\\s)"+t+"(?!\\S)");return!!e.className.match(n)},attr:function(e,t,n){console.assert(this._tq_accepts(e),e),console.assert(arguments.length!=3,arguments);if(arguments.length!=2&&arguments.length!=4||typeof t!="string"){if((arguments.length==2||arguments.length==4)&&typeof t=="object"){var r=t;for(var i in r){var s=r[i];e.setAttribute(i,s)}}if((arguments.length==3||arguments.length==5)&&typeof n=="function"){var o=-1;if(e.parentNode){var u=Array.prototype.slice.call(e.parentNode.children);o=u.indexOf(e)}var a=n.apply(e,[o,t]);e.setAttribute(t,a)}return(arguments.length==3||arguments.length==5)&&e.setAttribute(t,n),this}return this.attributes(e)[t]},attributes:function(e,t){console.assert(this._tq_accepts(e),e);if(t){for(var n in t)e.setAttribute(n,t[n]);return this}var r={};Object.defineProperty(r,"length",{enumerable:!1,value:e.attributes.length});for(var i=0;i<e.attributes.length;i++)r[e.attributes[i].nodeName]=e.attributes[i].nodeValue;return r},removeAttr:function(e,t){return console.assert(this._tq_accepts(e),e),e.removeAttribute(t),this},children:function(e,t){console.assert(this._tq_accepts(e),e);if(t)for(var n in t){var r=t[n];console.assert(this._tq_accepts(r),r),this._tq_accepts(r)&&e.appendChild(r)}var i=[];for(var n in e.childNodes)this._tq_accepts(e.childNodes[n])&&i.push(e.childNodes[n]);return i},remove:function(e){return console.assert(this._tq_accepts(e),e),e.parentNode&&e.parentNode.removeChild(e),this},addChild:function(e,t){return console.assert(this._tq_accepts(e),e),console.assert(this._tq_accepts(t),t),this._tq_accepts(t)&&e.appendChild(t),this},removeChild:function(e){return console.assert(this._tq_accepts(e),e),console.assert(this._tq_accepts(child),child),this._tq_accepts(child)&&e.removeChild(child),this},parent:function(e,t){return console.assert(this._tq_accepts(e),e),t&&this._tq_accepts(t)?(e.parentNode!=t&&(e.parentNode.removeChild(e),t.appendChild(),console.assert(e.parentNode==t,e,e.parentNode,t)),this):e.parentNode},clone:function(t){return console.assert(this._tq_accepts(t),t),e(t.cloneNode(!0))},append:function(e,t,n,i){console.assert(this._tq_accepts(e),e),this._tq_accepts(t)&&this.addChild(e,t);if(t instanceof r)for(var s=0;s<t.length;s++){var o=t[s];console.assert(this._tq_accepts(o),o),!isNaN(n)&&!isNaN(i)&&n!=i-1&&(o=this.clone(o)[0]),this.append(e,o)}return this},appendTo:function(t,n){console.assert(this._tq_accepts(t),t),this._tq_accepts(n)&&this._tq_accepts(t)&&n.appendChild(t);if(n instanceof r)for(var i=0;i<n.length;i++){var s=n[i];console.assert(this._tq_accepts(s),s),this.append(s,i==n.length-1?t:this.clone(t)[0])}return typeof n=="string"&&this.appendTo(t,e(n)),this},tagName:function(e){return console.assert(this._tq_accepts(e),e),e.tagName.toLowerCase()},id:function(e,t){return t?this.attr(e,"id",t):this.attr(e,"id")}})}),function(e){typeof define=="function"&&define.amd?define(["treequery"],e):typeof r!="undefined"?e(r):console.error("ERROR: can't register type. Enable to locate TreeQuery instance")}(function(e){e.register("js-object",{accepts:function(e){return!1},"class":function(e,t){},addClass:function(e,t){},removeClass:function(e,t){},hasClass:function(e,t){console.assert(this._tq_accepts(e),e)},attr:function(e){},atributtes:function(e){},removeAttr:function(e){},children:function(e,t){},addChild:function(e){},removeAttr:function(e){},parent:function(e,t){},tagName:function(e){},id:function(e,t){}})}),typeof define=="function"&&define.amd?define([],function(){return r}):(window.$=r,window.TreeQuery=r)})();