(function(e){function r(e,t){if(e instanceof r)return e;if(arguments.length==0){if(this instanceof r)return;return new r}if(!(this instanceof r))return new r(e,t);this.length=0,this._tq_selector=e,this._tq_context=t||this._tqGetDefaultContext(),this._tq_strategy=this._tqGetStrategy();if(Array.isArray(e)){for(var n in e)this.indexOf(e[n])==-1&&this.push(e[n]);return this}if(this._tq_strategy._tq_accepts(this._tq_selector))return this.push(this._tq_selector),console.assert(this.length==1,this),this;if(typeof e=="string"){if(e=="body"){var i=this._tqGetDefaultContext();return new r(i,i)}var s=this._tq_strategy._tq_parse(e);return s instanceof r?s:(new r(this._tq_context,this._tq_context)).find(e)}}function s(e,t){}function o(e){this._tg_strategy=e}var t="0.8.0",n=[];r.prototype=n,n.constructor=r,n._tqGetStrategy=function(){return r.Factory.getStrategy(this._tq_selector,this._tq_context)},n.valueOf=function(){return this.map(function(e){return e})},n._tqGetDefaultContext=function(){return document.body},n.find=function(e){return this._tq_selector=e,r.Engine.resolve(this)},n.children=function(){return r.Engine.children(this)},n.filter=function(e){return this._tq_selector=e,r.Engine.filter(this,e)},r._tq_version=t,r._tq=n,r._tq_types={},r._tq_register_api=function(e,t){for(var n in t)typeof t[n]=="function"&&(r._tq[n]=t[n])},r._tq_register_stratgy=function(e,t){var i=new s;for(var u in i)typeof i[u]=="function"&&!t[u]&&(t[u]=i[u]);var a=r._tq_types[e];a||(a=new o(e));for(var u in t)typeof t[u]=="function"&&(a[u]=t[u]);r._tq_types[e]=a;for(var e in t)typeof t[e]=="function"&&!n[e]&&function(e){n[e]=function(){var t=Array.prototype.map.call(arguments,function(e){return e});t.unshift(null),t.push(0),t.push(this.length);for(var n=0;n<this.length;n++){t[0]=this[n],t[t.length-2]=n;var r=this._tq_strategy[e].apply(this._tq_strategy,t);if(r!=this._tq_strategy)return r}return this}}(e)},r.Filters=function(e){this._filters=[],this._strategy=e},r.Filters.prototype={},r.Filters.prototype.constructor=r.Filters,r.Filters.prototype.append=function(e){this._filters.push(e)},r.Filters.prototype.check=function(e,t){var n=t||this._strategy;this._filters||console.warn("WARNING: check function not overwritten for this class: ",this);for(var r in this._filters){console.assert(typeof this._filters[r].check=="function",this._filters[r]);if(!this._filters[r].check(e,n))return!1}return this._filters.length>0},r.Filters.TageNameFilter=function(e){this._tagname=e.toLowerCase()},r.Filters.TageNameFilter.prototype=new r.Filters,r.Filters.TageNameFilter.prototype.constructor=r.Filters.TageNameFilter,r.Filters.TageNameFilter.prototype.check=function(e,t){return t._tq_tag_name(e).toLowerCase()==this._tagname},r.Filters.IdFilter=function(e){this._id=e.toLowerCase()},r.Filters.IdFilter.prototype=new r.Filters,r.Filters.IdFilter.prototype.constructor=r.Filters.IdFilter,r.Filters.IdFilter.prototype.check=function(e,t){var n=t._tq_id(e);return typeof n=="string"?n.toLowerCase()==this._id:!1},r.Filters.ClassFilter=function(e){this._classname=e.toLowerCase()},r.Filters.ClassFilter.prototype=new r.Filters,r.Filters.ClassFilter.prototype.constructor=r.Filters.ClassFilter,r.Filters.ClassFilter.prototype.check=function(e,t){var n=t._tq_class(e);for(var r in n)if(n[r].toLowerCase()==this._classname)return!0;return!1},r.Filters.AsterFilter=function(){},r.Filters.AsterFilter.prototype=new r.Filters,r.Filters.AsterFilter.prototype.constructor=r.Filters.AsterFilter,r.Filters.AsterFilter.prototype.check=function(){return!0},r.Engine={parseSelector:function(e){return[]},filter:function(e){var t=[],n=r.Factory.getFilter(e._tq_selector,e._tq_strategy),i=e.map(function(e){return e});while(i.length>0){var s=i.splice(0,1)[0];n.check(s)&&t.push(s)}return r(t,e._tq_context)},find:function(e){var t=[],n=r.Factory.getFilter(e._tq_selector,e._tq_strategy),i=e.map(function(e){return e});while(i.length>0){var s=i.splice(0,1)[0],o=e._tq_strategy._tq_children(s);for(var u in o)i.push(o[u]),n.check(o[u])&&t.push(o[u])}return r(t,e._tq_context)},apply:function(e,t,n,r){},resolve:function(e){var t=r;console.assert(typeof e._tq_selector=="string",e._tq_selector);var n,i=[],s=e._tq_selector.split(","),o=e._tq_selector.split(" "),u=s.length>1,a=o.length>1;if(u){n=s;for(var f in n)var l=i=i.concat(e.find(n[f]).valueOf());return r(i,e._tq_context)}if(a){n=o;function c(e,t){return e.find(t)}function h(e,t){return e.children().filter(t)}var p=c;$current=e;for(var f in n){if(n[f]=="")continue;if(n[f]==">"){p=h;continue}$current=p($current,n[f]),p=c}return $current}return r.Engine.find(e)},children:function(e){var t=[],n=e.map(function(e){return e});while(n.length>0){var i=n.splice(0,1)[0],s=e._tq_strategy._tq_children(i);t=t.concat(s)}return r(t,e._tq_context)},cache:{}},r.Factory={getStrategy:function(e,t){if(typeof r.Factory.cache[t]!="undefined")return r.Factory.cache[t];for(var n in r._tq_types){var i=r._tq_types[n];if(i._tq_accepts(t,e))return r.Factory.cache[t]=i,i}return null},getFilter:function(e,t){console.assert(typeof e=="string",e),console.assert(e.split(" ").length==1,e);var n=/:(\w+)\(/,i=/:(\w+)/,s,o,u,a,f,l,c;o=e;if(e.indexOf(".")!=-1){var s=e.split(".");o=s.splice(0,1)[0],a=s.map(function(e){return e.split("[")[0].split(":")[0]})}e=="*"&&(o="",c=!0);if(e.indexOf("#")!=-1){var s=e.split("#");o=s[0],u=s[1].split("[")[0].split(":")[0]}if(e.indexOf(":")!=-1){var s=e.split(":");f=s[1],u=s[1].split("[")[0].split(":")[0]}if(n.test(e)){var s=text.match(n);l=s[1]}else if(i.test(e)){var s=text.match(i);f=s[1]}var h=new r.Filters(t);c&&h.append(new r.Filters.AsterFilter),o&&h.append(new r.Filters.TageNameFilter(o)),u&&h.append(new r.Filters.IdFilter(u));for(var p in a)h.append(new r.Filters.ClassFilter(a[p]));return h},cache:{}};var i="ERROR: 'XXX' function must be overwritten";s.prototype={},s.prototype.constructor=s,o.prototype=new s,o.prototype.constructor=o,s.prototype._tq_accepts=function(e){return console.error(i.replace("XXX","check")),!1},s.prototype._tq_class=function(e,t){console.error(i.replace("XXX","_tq_class"))},s.prototype._tq_add_class=function(e){console.error(i.replace("XXX","_tq_add_class"))},s.prototype._tq_remove_class=function(e){console.error(i.replace("XXX","_tq_remove_class"))},s.prototype._tq_has_class=function(e){console.error(i.replace("XXX","_tq_has_class"))},s.prototype._tq_map_attr=function(e,t){console.error(i.replace("XXX","_tq_map_attr"))},s.prototype._tq_get_attr=function(e,t){console.error(i.replace("XXX","_tq_get_attr"))},s.prototype._tq_set_attr=function(e,t,n){console.error(i.replace("XXX","_tq_set_attr"))},s.prototype._tq_remove_attr=function(e,t){console.error(i.replace("XXX","_tq_remove_attr"))},s.prototype._tq_children=function(e){console.error(i.replace("XXX","_tq_children"))},s.prototype._tq_remove=function(e){console.error(i.replace("XXX","_tq_remove"))},s.prototype._tq_add_child=function(e){console.error(i.replace("XXX","_tq_add_child"))},s.prototype._tq_remove_child=function(e){console.error(i.replace("XXX","_tq_remove_child"))},s.prototype._tq_clone=function(e){console.error(i.replace("XXX","_tq_clone"))},s.prototype._tq_parent=function(e,t){console.error(i.replace("XXX","_tq_parent"))},s.prototype._tq_tag_name=function(e){console.error(i.replace("XXX","_tq_tag_name"))},s.prototype._tq_id=function(e,t){console.error(i.replace("XXX","_tq_id"))},r._tq_register_stratgy("html-element",{_tq_accepts:function(e){return e instanceof HTMLElement},_tq_parse:function(e){try{var t=document.createElement("div");t.innerHTML=e;var n=Array.prototype.map.call(t.childNodes,function(e){return e});return n.length==1&&n[0]instanceof Text?null:r(n)}catch(i){return null}},_tq_class:function(e,t){return console.assert(this._tq_accepts(e),e),t?(e.className=t,this):e.className.split(" ")},_tq_add_class:function(e,t){return console.assert(this._tq_accepts(e),e),e.className+=" "+t,this},_tq_remove_class:function(e,t){return console.assert(this._tq_accepts(e),e),e.className=e.className.replace(new RegExp("(?:^|\\s)"+t+"(?!\\S)","g"),""),this},_tq_has_class:function(e,t){console.assert(this._tq_accepts(e),e);var n=new RegExp("(?:^|\\s)"+t+"(?!\\S)");return!!e.className.match(n)},_tq_get_css:function(e,t){return e.style[t]},_tq_set_css:function(e,t,n){return e.style[t]=n},_tq_get_attr:function(e,t){return console.assert(this._tq_accepts(e),e),console.assert(typeof t=="string",arguments),e.getAttribute(t)},_tq_set_attr:function(e,t,n){return console.assert(this._tq_accepts(e),e),console.assert(typeof t=="string",arguments),e.setAttribute(t,n)},_tq_map_attr:function(e){console.assert(this._tq_accepts(e),e);var t={};Object.defineProperty(t,"length",{enumerable:!1,value:e.attributes.length});for(var n=0;n<e.attributes.length;n++)t[e.attributes[n].nodeName]=e.attributes[n].nodeValue;return t},_tq_set_map_attr:function(e,t){console.assert(this._tq_accepts(e),e);for(var n=0;n<e.attributes.length;n++)e.removeAttribute(e.attributes[n].nodeValue);for(var r in t)e.setAttribute(r,t[r]);return this},_tq_remove_attr:function(e,t){return console.assert(this._tq_accepts(e),e),e.removeAttribute(t),this},_tq_children:function(e){console.assert(this._tq_accepts(e),e);var t=[];for(var n in e.childNodes)this._tq_accepts(e.childNodes[n])&&t.push(e.childNodes[n]);return t},_tq_remove:function(e){return console.assert(this._tq_accepts(e),e),e.parentNode&&e.parentNode.removeChild(e),this},_tq_add_child:function(e,t){return console.assert(this._tq_accepts(e),e),console.assert(this._tq_accepts(t),t),this._tq_accepts(t)&&e.appendChild(t),this},_tq_remove_child:function(e,t){return console.assert(this._tq_accepts(e),e),console.assert(this._tq_accepts(t),t),this._tq_accepts(t)&&e.removeChild(t),this},_tq_parent:function(e,t){return console.assert(this._tq_accepts(e),e),t&&this._tq_accepts(t)?(e.parentNode!=t&&(e.parentNode.removeChild(e),t.appendChild(e),console.assert(e.parentNode==t,e,e.parentNode,t)),this):e.parentNode},_tq_clone:function(e){return console.assert(this._tq_accepts(e),e),e.cloneNode(!0)},_tq_tag_name:function(e){return console.assert(this._tq_accepts(e),e),e.tagName.toLowerCase()},_tq_id:function(e,t){return t?this._tq_set_attr(e,"id",t):this._tq_get_attr(e,"id")},_tq_offset:function(e,t){return t?(e.style.width=t,this):e.offsetWidth()},_tq_width:function(e,t){return t?(e.style.width=t,this):e.offsetWidth()},_tq_height:function(e,t){return t?(e.style.height=t,this):e.offsetHeight()}}),r._tq_register_stratgy("js-object",{accepts:function(e){return!1},_tq_class:function(e,t){},_tq_add_class:function(e,t){},_tq_remove_class:function(e,t){},_tq_has_class:function(e,t){console.assert(this._tq_accepts(e),e)},_tq_set_attr:function(e){},_tq_map_attr:function(e){},_tq_remove_attr:function(e){},_tq_children:function(e){},_tq_remove:function(e){},_tq_add_child:function(e){},_tq_remove_child:function(e){},_tq_parent:function(e,t){},_tq_tag_name:function(e){},_tq_id:function(e,t){}}),r._tq_register_api("jquery-dom-manage",{each:function(e){var t=null;for(var n=0;n<this.length;n++){t=e.call(this[n],this[n],n,this);if(t)break}return this},offset:function(){return{top:this[0].offsetTop,left:this[0].offsetLeft}},eq:function(e){return this[e]},is:function(e){return console.assert(!1,"TreeQuery.BaseStrategy.is NOT IMPLEMENTED YET"),$()},next:function(){return console.assert(!1,"TreeQuery.BaseStrategy.next NOT IMPLEMENTED YET"),!1},"class":function(e){return this._tq_strategy._tq_class(this[0],e)},addClass:function(e){return this.each(function(t,n,r){r._tq_strategy._tq_add_class(t,e)})},removeClass:function(e){return this.each(function(t,n,r){r._tq_strategy._tq_remove_class(t,e)})},hasClass:function(e){return this._tq_strategy._tq_has_class(this[0],e)},css:function(e,t){if(arguments.length==1){if(typeof e=="object"){for(var n in e)this.css(n,e[n]);return this}if(typeof e=="string")return this.length==0?null:self._tq_strategy._tq_set_css(this[0],e,t)}return arguments.length==2&&typeof e=="string"?this.each(function(n,r,i){i._tq_strategy._tq_set_css(n,e,t)}):this},attr:function(e,t){if(arguments.length==1&&typeof e=="string")return this._tq_strategy._tq_get_attr(this[0],e);if(arguments.length!=2||typeof e!="string"||typeof t!="string"&&typeof t!="number"){if(arguments.length==2&&typeof e=="string"&&typeof t=="function")return this.each(function(n,r,i){var s=t.apply(n,[r,e]);i._tq_strategy._tq_set_attr(n,e,s)});if(typeof e=="object"){var n=e;for(var r in n){var i=n[r];this.each(function(e,t,n){n._tq_strategy._tq_set_attr(e,r,i)})}}return this}return this.each(function(n,r,i){i._tq_strategy._tq_set_attr(n,e,t)})},attributes:function(e){return arguments.length==0?this._tq_strategy._tq_map_attr(this[0]):this.each(function(t,n,r){r._tq_strategy._tq_set_map_attr(t,e)})},removeAttr:function(e){return this.each(function(t,n,r){r._tq_strategy._tq_remove_attr(t,e)})},children:function(e){console.assert(!e||typeof e=="string",arguments);var t=null;e&&(t=r(e));var n=[];return this.each(function(e,r,i){var s=i._tq_strategy._tq_children(e);if(t)for(var o=0;o<t.length;o++)for(var u=0;u<s.length;u++)t[o]==s[u]&&n.push(s[u]);else n=n.concat(s)}),r(n)},remove:function(){return this.each(function(e,t,n){n._tq_strategy._tq_remove(e)})},parent:function(e){console.assert(!e||typeof e=="string",arguments);var t=null;e&&(t=r(e));var n=[];return this.each(function(e,r,i){var s=i._tq_strategy._tq_parent(e);if(t)for(var o=0;o<t.length;o++)t[o]==s&&n.push(s);else n.push(s)}),r(n)},clone:function(){var e=[];return this.each(function(t,n,r){var i=r._tq_strategy._tq_clone(t);e.pus(i)}),r(e)},append:function(e){return this.each(function(t,n,i){i._tq_strategy._tq_accepts(e)&&i._tq_strategy._tq_add_child(node,e);if(e instanceof r)for(var s=0;s<e.length;s++){var o=e[s];console.assert(i._tq_strategy._tq_accepts(o),o),!isNaN(n)&&n!=i.length-1&&(o=i._tq_strategy._tq_clone(o)),i._tq_strategy._tq_add_child(t,o)}typeof e=="string"&&i.append(r(e))})},appendTo:function(e){return typeof e=="string"&&(e=new r(e,this._tqGetDefaultContext())),this.each(function(t,n,i){i._tq_strategy._tq_accepts(e)&&i._tq_strategy._tq_add_child(e,t);if(e instanceof r)for(var s=0;s<e.length;s++){var o=e[s];console.assert(i._tq_strategy._tq_accepts(o),o),s==e.length-1?i._tq_strategy._tq_add_child(o,t):i._tq_strategy._tq_add_child(o,i._tq_strategy._tq_clone(t))}})},height:function(e){return e?(typeof e=="number"&&(e+="px"),this.each(function(t,n,r){r._tq_strategy._tq_height(t,e)})):this._tq_strategy._tq_height(this[0])},width:function(e){return e?(typeof e=="number"&&(e+="px"),this.each(function(t,n,r){r._tq_strategy._tq_width(t,e)})):this._tq_strategy._tq_width(this[0])}}),typeof define=="function"&&define.amd?define("treequery",[],function(){return r}):(window.$=r,window.TreeQuery=r)})();